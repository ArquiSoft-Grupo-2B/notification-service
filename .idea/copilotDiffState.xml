<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/CRON_JOB_README.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/CRON_JOB_README.md" />
              <option name="updatedContent" value="# Notification Service - Cron Job de Engagement&#10;&#10;##  Funcionalidad del Cron Job&#10;&#10;Este servicio incluye un **cron job automático** que envía emails graciosos de engagement a todos los usuarios registrados en la plataforma para motivarlos a volver a usar la aplicación.&#10;&#10;## ⚙️ Configuración&#10;&#10;### Horario de Ejecución&#10;&#10;El cron job está configurado en `application.properties`:&#10;&#10;```properties&#10;scheduler.engagement.cron=0 0 10 * * *&#10;```&#10;&#10;**Por defecto**: Se ejecuta todos los días a las **10:00 AM**&#10;&#10;### Cambiar el Horario&#10;&#10;Puedes modificar el horario editando la propiedad `scheduler.engagement.cron` en `application.properties`.&#10;&#10;#### Ejemplos de Configuración Cron:&#10;&#10;| Expresión | Descripción |&#10;|-----------|-------------|&#10;| `0 0 10 * * *` | Todos los días a las 10:00 AM |&#10;| `0 0 18 * * *` | Todos los días a las 6:00 PM |&#10;| `0 0 9 * * MON` | Todos los lunes a las 9:00 AM |&#10;| `0 0 12 * * MON-FRI` | De lunes a viernes a las 12:00 PM |&#10;| `0 */5 * * * *` | Cada 5 minutos (útil para pruebas) |&#10;| `0 */30 * * * *` | Cada 30 minutos |&#10;&#10;**Formato**: `segundo minuto hora día mes día-semana`&#10;&#10;##  ¿Qué Hace el Cron Job?&#10;&#10;1. **Obtiene todos los usuarios** mediante la query GraphQL `listUsers`&#10;2. **Valida que cada usuario tenga email** registrado&#10;3. **Genera un email gracioso y personalizado** para cada usuario con:&#10;   - Saludo personalizado usando el alias del usuario&#10;   - Mensaje gracioso aleatorio&#10;   - Motivación para volver a usar la app&#10;   - Datos curiosos sobre caminar/correr&#10;   - Emojis y formato atractivo&#10;4. **Envía el email** a cada usuario&#10;5. **Registra estadísticas** de éxito/fallos en los logs&#10;&#10;##  Ejemplos de Mensajes&#10;&#10;### Asuntos Aleatorios:&#10;- ‍♂️ ¡Tus zapatillas te extrañan!&#10;- ‍♀️ ¿Olvidaste que tienes piernas?&#10;- ⏰ ¡Es hora de mover esas piernas!&#10;-  Tu próxima aventura te está esperando&#10;-  ¡Las rutas te están llamando!&#10;&#10;### Mensajes Graciosos:&#10;- &quot;¿Sigues vivo? ¡Hace tiempo que no te vemos correr por nuestra app! ‍♂️&quot;&#10;- &quot;Tus zapatillas nos preguntaron por ti... ¿Cuándo vuelves? &quot;&#10;- &quot;Las rutas están aburridas sin ti. ¡Vuelve a conquistarlas! ️✨&quot;&#10;&#10;##  Probar el Cron Job&#10;&#10;### Opción 1: Ejecutar Inmediatamente (Para Desarrollo)&#10;&#10;Cambia temporalmente la configuración a cada minuto:&#10;```properties&#10;scheduler.engagement.cron=0 */1 * * * *&#10;```&#10;&#10;### Opción 2: Ejecutar Manualmente&#10;&#10;Puedes crear un endpoint REST para disparar el envío manualmente (opcional).&#10;&#10;##  Logs&#10;&#10;El cron job genera logs detallados:&#10;&#10;```&#10;===== Iniciando envío de emails de engagement =====&#10;Fecha y hora: 19/10/2025 10:00:00&#10;Se encontraron 36 usuarios. Iniciando envío de emails...&#10;✅ Email enviado exitosamente a: TestUser (juan.h@gmail.com)&#10;✅ Email enviado exitosamente a: pepito (pepito@gmail.com)&#10;...&#10;===== Envío de emails completado =====&#10;✅ Exitosos: 34 | ❌ Fallidos: 2 | Total: 36&#10;```&#10;&#10;##  Requisitos&#10;&#10;- Variables de entorno configuradas:&#10;  - `SPRING_MAIL_USERNAME`: Tu email de Gmail&#10;  - `SPRING_MAIL_PASSWORD`: Contraseña de aplicación de Gmail&#10;- Servicio GraphQL corriendo en `http://localhost:8000/graphql`&#10;&#10;##  Mejoras Futuras&#10;&#10;El email actual es básico y se envía a **todos** los usuarios. Próximas mejoras planeadas:&#10;&#10;- ✅ Filtrar usuarios inactivos (que no han usado la app en X días)&#10;- ✅ Personalización basada en historial del usuario&#10;- ✅ A/B testing de diferentes mensajes&#10;- ✅ Segmentación por nivel de actividad&#10;- ✅ Templates HTML con diseño atractivo&#10;- ✅ Métricas de apertura y clicks&#10;&#10;##  Archivos Modificados/Creados&#10;&#10;- ✅ `GraphQLResponse.java` - Añadido soporte para `listUsers`&#10;- ✅ `GraphQLClientService.java` - Método `getAllUsers()`&#10;- ✅ `UserEngagementScheduler.java` - Cron job principal (NUEVO)&#10;- ✅ `NotificationServiceApplication.java` - Habilitado `@EnableScheduling`&#10;- ✅ `application.properties` - Configuración del cron&#10;&#10;## ⚠️ Notas Importantes&#10;&#10;- El cron job incluye una pausa de 100ms entre emails para no saturar el servidor SMTP&#10;- Los usuarios sin email registrado son saltados automáticamente&#10;- Los errores en envíos individuales no detienen el proceso completo&#10;- Todos los eventos son loggeados para debugging&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/docker-compose.yml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/docker-compose.yml" />
              <option name="originalContent" value="services:&#10;  rabbit:&#10;    image: &quot;rabbitmq:4.0.2-management&quot;&#10;    container_name: rabbit&#10;    ports:&#10;      - &quot;5672:5672&quot;&#10;      - &quot;15672:15672&quot;&#10;    environment:&#10;      RABBITMQ_DEFAULT_USER: &quot;guest&quot;&#10;      RABBITMQ_DEFAULT_PASS: &quot;guest&quot;&#10;    volumes:&#10;      - ../rabbitmq/data:/var/lib/rabbitmq&#10;      - ../rabbitmq/log:/var/log/rabbitmq&#10;    networks:&#10;      - notification_network&#10;&#10;  notification-service:&#10;    build:&#10;      context: .&#10;      dockerfile: dockerfile&#10;    container_name: notification-service&#10;    ports:&#10;      - &quot;8085:8085&quot;&#10;    env_file:&#10;      - .env&#10;    environment:&#10;      SPRING_RABBITMQ_HOST: rabbit&#10;      SPRING_RABBITMQ_PORT: 5672&#10;      SPRING_RABBITMQ_USERNAME: guest&#10;      SPRING_RABBITMQ_PASSWORD: guest&#10;    depends_on:&#10;      - rabbit&#10;    networks:&#10;      - notification_network&#10;&#10;networks:&#10;    notification_network:&#10;       external: true&#10;       name: routes_shared_network" />
              <option name="updatedContent" value="services:&#10;  rabbit:&#10;    image: &quot;rabbitmq:4.0.2-management&quot;&#10;    container_name: rabbit&#10;    ports:&#10;      - &quot;5672:5672&quot;&#10;      - &quot;15672:15672&quot;&#10;    environment:&#10;      RABBITMQ_DEFAULT_USER: &quot;guest&quot;&#10;      RABBITMQ_DEFAULT_PASS: &quot;guest&quot;&#10;    volumes:&#10;      - ../rabbitmq/data:/var/lib/rabbitmq&#10;      - ../rabbitmq/log:/var/log/rabbitmq&#10;    networks:&#10;      - notification_network&#10;&#10;  notification-service:&#10;    build:&#10;      context: .&#10;      dockerfile: dockerfile&#10;    container_name: notification-service&#10;    ports:&#10;      - &quot;8085:8085&quot;&#10;    env_file:&#10;      - .env&#10;    environment:&#10;      SPRING_RABBITMQ_HOST: rabbit&#10;      SPRING_RABBITMQ_PORT: 5672&#10;      SPRING_RABBITMQ_USERNAME: guest&#10;      SPRING_RABBITMQ_PASSWORD: guest&#10;    depends_on:&#10;      - rabbit&#10;    networks:&#10;      - notification_network&#10;&#10;networks:&#10;    notification_network:&#10;       external: true&#10;       name: routes_shared_network" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>